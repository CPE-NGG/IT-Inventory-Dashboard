<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>IT Inventory Dashboard</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ========== 1. GLOBAL & ROOT STYLES ========== */
        /* CSS variables for consistent theming */
        :root {
            --bg: #f4f6f8;         /* Page background */
            --card: #fff;          /* Card background */
            --muted: #666;         /* Muted text */
            --accent: #00a79d;     /* Accent color */
            --header-bg: #065751;  /* Header background */
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --dark: #333333;
            --gray: #dcdcdc;
        }
 
        /* Basic styles for the entire document */
        html, body {
            height: 100%;
            margin: 0;
            font-family: Segoe UI, Roboto, Arial, sans-serif;
            background: var(--bg);
            font-size: 14px;
        }
 
        /* Universal box-sizing for easier layout calculations */
        * {
            box-sizing: border-box;
        }
 
        /* ============== 2. LAYOUT STYLES ============= */
        
        /* Header section styles */
        header {
            background: var(--header-bg);
            color: #fff;
            display: flex;
            gap: 8px;
            padding: 8px 13px;
            align-items: center;
        }
        
        /* Main content wrapper */
        .wrap {
            padding: 5px;
            height: calc(100% - 44px);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        /* Top section containing the main columns */
        .top {
            display: flex;
            gap: 5px;
            align-items: flex-start;
        }
 
        /* Bottom section for summary cards */
        .bottom {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 10px;
        }
 
        /* Column layout definitions */
        .wide, .right-col, .tasks-col {
            flex: none;
            width: 33%;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        /* ============ 3. COMPONENT STYLES ============ */
 
        /* Base panel style used for most containers */
        .panel {
            background: var(--card);
            border-radius: 8px;
            padding: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }
 
        /* Header navigation buttons */
        header .nav-btn {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.06);
            color: #fff;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        header .nav-btn:hover { background: rgba(255,255,255,0.1); }
        header .nav-btn.active { background: rgba(255,255,255,0.06); }
 
        /* Summary cards in the bottom section */
        .summary-card {
            background: var(--card);
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.06);
            border: 1px solid #e9ecef;
        }
        .summary-card h5 {
            margin: 0;
            font-size: 1rem;
            color: var(--dark);
        }
        .summary-card .value {
            font-size: 2rem;
            font-weight: 700;
            margin: 5px 0;
            color: var(--accent);
        }
        .summary-card .meta {
            font-size: 11px;
            color: var(--muted);
            margin-top: 3px;
        }
        .summary-card .meta strong {
            font-weight: 600;
            color: var(--dark);
        }
 
        /* ----- PIE CHART COMPONENTS ----- */
        .pie-row {
            display: flex;
            gap: 5px;
            align-items: stretch;
            height: 200px;
            position: relative;
        }
        .pie-box {
            width: 200px;
            padding: 5px;
            display: flex;
            flex-direction: column;
        }
        .pie-box strong {
            align-self: flex-start;
            margin-bottom: 6px;
        }
        .pie-box canvas {
            flex: 1;
            align-self: center;
            justify-content: center;
            width: 90% !important;
            height: auto !important;
        }
        
        /* ----- LIST & SEARCH COMPONENTS ----- */
        .list-box {
            position: relative;
            flex: 1;
            padding: 5px;
            border-left: 1px solid #eef3f6;
            height: 100%;
            overflow-y: scroll;
            scrollbar-width: thin;
        }
        .list-box h4, .list-box h5 {
            margin: 0 0 6px;
            font-size: 14px;
            color: var(--accent);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: calc(100% - 40px);
        }
        .list-box ul {
            margin: 0;
            padding-left: 18px;
            color: var(--muted);
            font-size: 13px;
        }
        .list-box li:hover {
            background: #f0f4f7;
            border-radius: 3px;
        }
        .list-search {
            width: 60%;
            padding: 4px 0;
            font-size: 13px;
            border: none;
            border-bottom: 1px solid #ccc;
            background: transparent;
            color: var(--muted);
            margin-bottom: 8px;
        }
        .list-search::placeholder { color: #aaa; }
        .list-search:focus {
            outline: none;
            border-bottom: 1px solid var(--accent);
        }
        
        .clear-btn {
            position: absolute;
            background: #fff;
            border: none;
            font-size: 13px;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            color: var(--muted);
            display: none;
        }
        .clear-btn:hover {
            color: var(--danger);
            background-color: transparent;
        }
 
        /* Style for highlighted search text */
        mark {
            background-color: var(--warning);
            color: #000;
            padding: 0 1px;
            border-radius: 1px;
        }
 
        /* ----- TASK LIST COMPONENTS ----- */
        .addTask-form {
            width: 100%;
            display: flex;
            gap: 5px;
            margin-bottom: 0px;
            position: relative;
        }
        .addTask-form input {
            font-size: 13px;
            padding: 5px 5px 5px 0;
            flex-grow: 1;
            border: none;
            border-bottom: 1px solid #ccc;
        }
        .addTask-form button {
            margin-left: 25px;
            margin-right: 1px;
            padding: 5px 10px;
            font-size: 13px;
            cursor: pointer;
            background-color: var(--accent);
            color: #fff;
            border: none;
            border-radius: 4px;
        }
        .addTask-form button:hover {
            background-color: var(--header-bg);
        }
 
        .clear-btn-task {
            position: absolute;
            right: 40px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent !important;
            border: none;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa !important;
            display: none;
            transition: color 0.2s ease;
        }
        .clear-btn-task:hover {
            color: var(--danger) !important;
        }
 
        #taskListTable {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
            table-layout: fixed;
        }
        /* To make the added list left-aligned */
        /* #taskListTable td:nth-child(2) {
            text-align: left;
        } */
        #taskListTable thead th:first-child {
            border-top-left-radius: 8px;
        }
        #taskListTable thead th:last-child {
            border-top-right-radius: 8px;
        }
        #taskListTable tbody tr:last-child td:first-child {
            border-bottom-left-radius: 8px;
        }
        #taskListTable tbody tr:last-child td:last-child {
            border-bottom-right-radius: 8px;
        }
        #taskListTable th, #taskListTable td {
            padding: 6px;
            border-bottom: 1px solid #ccc;
            text-align: center;
            word-wrap: break-word;
            white-space: normal;
        }
        #taskListTable th:first-child,
        #taskListTable td:first-child {
            border-right: 1px solid #ccc;
            width: 80px;
        }
        #taskListTable th:last-child,
        #taskListTable td:last-child {
            width: 50px;
        }
        #taskList tr.done td {
            text-decoration: line-through;
            color: gray;
        }
        .task-text[contenteditable="true"] {
            outline: none;
            border: none;
            border-bottom: 1px solid var(--accent);
            background-color: var(--card);
        }
 
        #newTaskInput {
            flex-grow: 1;
            min-width: 0;
            padding-right: 0px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        #newTaskInput::placeholder { color: #aaa; }
        #newTaskInput:focus {
            outline: none;
            border-bottom: 1px solid var(--accent);
        }
 
        .edit-message {
            text-align: center;
            padding: 5px;
            font-size: 0.9em;
            color: #888;
            border: none;
        }
        .edit-message-row td {
            border: none;
        }
 
        /* Style for the new delete button */
        .delete-btn {
            background: transparent;
            border: none;
            color: #aaa;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: color 0.2s ease;
        }
        .delete-btn:hover {
            color: var(--danger);
        }
        
        /* ========== 4. UTILITY & ZOOM STYLES ========= */
        
        /* Status color utility classes */
        .warn { color: var(--danger); font-weight: 600; }
        .note { color: var(--warning); font-weight: 600; }
        
        /* ----- SCROLLBAR STYLES ----- */
        .scrollable, .list-box {
            overflow-y: auto;
            scrollbar-width: thin;
        }
        .scrollable::-webkit-scrollbar, .list-box::-webkit-scrollbar {
            width: 8px;
        }
        .scrollable::-webkit-scrollbar-thumb, .list-box::-webkit-scrollbar-thumb {
            background-color: var(--gray);
            border-radius: 4px;
        }
        .scrollable::-webkit-scrollbar-track, .list-box::-webkit-scrollbar-track {
            background: transparent;
        }
        .scroll-dark::-webkit-scrollbar-thumb { /* Darker thumb on hover/focus */
            background-color: #888;
        }
        
        /* ----- ZOOM OVERLAY & BUTTON ----- */
        .zoom-btn {
            background: transparent;
            border: none;
            font-size: 18px;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            position: absolute;
            top: 0px;
            right: 10px;
            z-index: 10;
        }
        .zoom-btn:hover {
            color: var(--danger);
            background-color: transparent;
        }
        
        #zoom-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.2);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        #zoom-overlay .pie-row {
            width: 90%;
            height: 80%;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            padding: 10px;
            display: flex;
            gap: 5px;
            overflow: hidden;
        }
        #zoom-overlay .list-box h4,
        #zoom-overlay .list-box h5 {
            white-space: normal;
            overflow: visible;
            max-width: 100%;
        }
        #zoom-overlay strong, #zoom-overlay h4, #zoom-overlay h5,
        #zoom-overlay ul, #zoom-overlay .list-search {
            font-size: 1.1em;
        }
        #zoom-overlay .pie-box {
            width: 40%;
            justify-content: center;
        }
        #zoom-overlay .pie-box canvas {
            width: 95% !important;
            height: 95% !important;
        }
        #zoom-overlay .list-box {
            max-width: 60%;
        }
        #zoom-overlay .zoom-btn {
            top: 10px;
            right: 20px;
        }
 
        /* ----- For Changed History ----- */
        #historyList li {
            white-space: normal;
            padding-right: 10px;
            overflow-wrap: break-word;
        }
    
        /* ----- Flash during changes ----- */
        .flash-green {
            background-color: #c8f7c5;
            transition: background-color 1s ease;
        }
        .flash-yellow {
            background-color: #fff8c6;
            transition: background-color 1s ease;
        }
        .flash-red {
            background-color: #f7c5c5;
            transition: background-color 1s ease;
        }
        .flash-gray {
            background-color: #e0e0e0;
            transition: background-color 1s ease;
        }
 
    </style>
</head>
 
<body>
    <header>
        <button class="nav-btn active"><i class="fas fa-home"></i> Home</button>
        <button class="nav-btn">IT Inventory</button>
        <button class="nav-btn">Software</button>
        <button class="nav-btn">Components</button>
        <button class="nav-btn">Peripherals</button>
        <button class="nav-btn">MIS Logs</button>
    </header>
 
    <div class="wrap">
 
        <div class="top">
 
            <div class="panel wide">
                <h3 style="margin:0;color:var(--accent)">SGC Monitoring</h3>
 
                <div class="pie-row">
                    <div class="pie-box panel">
                        <strong>Deployed vs Not Deployed</strong>
                        <button class="zoom-btn" onclick="toggleZoom(this)">⛶</button>
                        <canvas id="sgcDeployed"></canvas>
                    </div>
                    <div class="list-box panel">
                        <h4>Deployed devices</h4>
                        <input type="text" class="list-search" placeholder="Search..." onkeyup="filterList(this)" />
                        <button type="button" class="clear-btn" onclick="clearSearch(this)">✖</button>
                        <ul>
                            <li>MIS — ITPC1 </li>
                            <li>MIS — ITPC2 </li>
                            <li>MIS — ITPC3 </li>
                            <li>MIS — ITPC4 </li>
                            <li>MIS — ITPC5 </li>
                            <li>ACCOUNTING — ACCTPC1 </li>
                            <li>ACCOUNTING — ACCTPC2 </li>
                            <li>ACCOUNTING — ACCTPC3 </li>
                            <li>ACCOUNTING — ACCTPC4 </li>
                            <li>ACCOUNTING — ACCTPC5 </li>
                            <li>ACCOUNTING — ACCTPC6 </li>
                            <li>CASH — CASHPC5 </li>
                        </ul>
                    </div>
                </div>
 
                <div class="pie-row">
                    <div class="pie-box panel">
                        <strong>Online vs Offline (Deployed)</strong>
                        <button class="zoom-btn" onclick="toggleZoom(this)">⛶</button>
                        <canvas id="sgcStatus"></canvas>
                    </div>
                    <div class="list-box panel">
                        <h4>Online / Offline</h4>
                        <input type="text" class="list-search" placeholder="Search..." onkeyup="filterList(this)" />
                        <button type="button" class="clear-btn" onclick="clearSearch(this)">✖</button>
                        <ul>
                            <li>PC010 — Offline</li>
                            <li>PC011 — Offline</li>
                            <li>PC020 — Online</li>
                            <li>PC021 — Online</li>
                            <li>PC022 — Online</li>
                        </ul>
                    </div>
                </div>
            </div>
 
            <div class="panel right-col">
                <h3 style="margin:0;color:var(--accent)">Windows Defender</h3>
                
                <div class="pie-row">
                    <div class="pie-box panel">
                        <strong>Status</strong>
                        <button class="zoom-btn" onclick="toggleZoom(this)">⛶</button>
                        <canvas id="defenderInstalled"></canvas>
                    </div>
                    <div class="list-box panel">
                        <h4>Inactive</h4>
                        <input type="text" class="list-search" placeholder="Search..." onkeyup="filterList(this)" />
                        <button type="button" class="clear-btn" onclick="clearSearch(this)">✖</button>
                        <ul>
                            <li>PC050 — Office X</li>
                            <li>PC051 — Office Y</li>
                            <li>PC052 — Office Z</li>
                        </ul>
                    </div>
                </div>
 
                <div class="pie-row">
                    <div class="pie-box panel">
                        <strong>Updated vs Outdated</strong>
                        <button class="zoom-btn" onclick="toggleZoom(this)">⛶</button>
                        <canvas id="defenderStatus"></canvas>
                    </div>
                    <div class="list-box panel">
                        <h4>Defender Versions (Inventory)</h4>
                        <input type="text" class="list-search" placeholder="Search..." onkeyup="filterList(this)" />
                        <button type="button" class="clear-btn" onclick="clearSearch(this)">✖</button>
                        <ul>
                            <li>4.18.23060.1000 — 150 devices</li>
                            <li>4.17.22586.0 — 20 devices</li>
                            <li>4.16.21001.0 — 5 devices</li>
                        </ul>
                        <p style="margin-top:6px;font-size:13px;color:var(--muted)">
                            <strong>Latest (MS):</strong> 4.18.23060.1000
                        </p>
                    </div>
                </div>
            </div>
 
            <div class="panel tasks-col">
                <h3 style="margin:0;color:var(--accent)">Tasks Overview</h3>
                
                <div class="addTask-form">
                    <input type="text" id="newTaskInput" placeholder="Enter new task...">
                    <button type="button" class="clear-btn-task" onclick="clearTaskInput()">✖</button>
                    <button onclick="addTask()">Add</button>
                </div>
 
                <div class="panel scrollable" style="height:170px; margin-bottom:0px;">
                    <table id="taskListTable">
                        <thead>
                            <tr style="background:var(--header-bg);color:#fff;">
                                <th>Done</th>
                                <th>Task</th>
                                <th></th> </tr>
                        </thead>
                        <tbody id="taskList"></tbody>
                    </table>
                </div>
                
                <div class="panel scrollable" style="height:200px; overflow-y:auto;">
                    <h4 style="margin:0 0 5px;color:var(--accent);font-size:14px;">Change History</h4>
                    <ul id="historyList"></ul>
                </div>
            </div>
        </div>
 
        <div class="bottom">
            <div class="summary-card">
                <h5>Desktops</h5>
                <span class="value">300</span>
                <p class="meta"><strong>Active</strong>: 300 | <strong>Standby</strong>: 100</p>
            </div>
 
            <div class="summary-card">
                <h5>Laptops</h5>
                <span class="value">200</span>
                <p class="meta"><strong>Active</strong>: 200 | <strong>Standby</strong>: 150</p>
            </div>
 
            <div class="summary-card">
                <h5>UPS Units</h5>
                <p class="meta"><strong>Active</strong>: 50 | <strong>Standby</strong>: 10</p>
                <p class="meta note">Near Replacement: <strong>5</strong></p>
                <p class="meta warn">Battery Expired: <strong>2</strong></p>
            </div>
 
            <div class="summary-card">
                <h5>Spare Components</h5>
                <p class="meta">RAMs: <strong>3</strong></p>
                <p class="meta">Storage: <strong>2</strong></p>
                <p class="meta warn">Power Supplies: <strong>1</strong></p>
            </div>
            
            <div class="summary-card">
                <h5>Network Peripherals</h5>
                <p class="meta">Switches: <strong>15</strong> active</p>
                <p class="meta">Routers: <strong>10</strong> active</p>
                <p class="meta">Printers: <strong>15</strong> active</p>
            </div>
        </div>
    </div>
 
    <div id="zoom-overlay"></div>
 
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ========= 1. CHART SETUP & HELPERS ========== //
        // Global default settings for all charts
        Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';
        Chart.defaults.plugins.legend.position = 'bottom';
        Chart.defaults.plugins.tooltip.boxPadding = 8;
 
        /* Creates a doughnut chart with default theme colors and hover effects. */
        function makeThemedPie(id, labels, data) {
            const rootStyles = getComputedStyle(document.documentElement);
            const headerBg = rootStyles.getPropertyValue('--header-bg').trim();
            const gray = rootStyles.getPropertyValue('--gray').trim();
 
            const ctx = document.getElementById(id).getContext('2d');
            
            // Check for an existing chart and destroy it to prevent conflicts
            const existingChart = Chart.getChart(id);
            if (existingChart) {
                existingChart.destroy();
            }
            
            const chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels,
                    datasets: [{
                        data,
                        backgroundColor: [headerBg, gray],
                        hoverBackgroundColor: [darkenColor(headerBg, 15), '#bfbfbf'],
                        hoverOffset: 30
                    }]
                },
                options: {
                    cutout: '50%',
                    radius: '85%',
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            align: 'start',
                            onClick: null,
                        }
                    },
                    maintainAspectRatio: false,
                    animation: { animateRotate: true, animateScale: true }
                }
            });
 
            return chart;
        }
 
        /* Darkens a given hex color by a specified percentage. */
        function darkenColor(hex, percent) {
            hex = hex.replace(/^#/, '');
            const num = parseInt(hex, 16),
                amt = Math.round(2.55 * percent),
                R = (num >> 16) - amt,
                G = (num >> 8 & 0x00FF) - amt,
                B = (num & 0x0000FF) - amt;
            return '#' + (
                0x1000000 +
                (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
                (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +
                (B < 255 ? (B < 1 ? 0 : B) : 255)
            ).toString(16).slice(1);
        }
 
        // --- Reusable helpers ---
        function confirmAction(message) {
            return confirm(message);
        }
 
        const FLASH_DURATION = 1000; // 1s, used for both table rows and history
 
        function flashBoth(historyEl, row, cssClass, duration = 1000) {
            if (!historyEl) return;
 
            requestAnimationFrame(() => {
                // apply flash classes AFTER element is in DOM
                historyEl.classList.add(cssClass);
                if (row) {
                    row.querySelectorAll('td').forEach(cell => {
                        cell.classList.add(cssClass);
                    });
                }
 
                setTimeout(() => {
                    historyEl.classList.remove(cssClass);
                    if (row) {
                        row.querySelectorAll('td').forEach(cell => {
                            cell.classList.remove(cssClass);
                        });
                    }
                }, duration);
            });
        }
 
        // ======== 2. UI INTERACTION HANDLERS ========= //
        /* Toggles a zoomed-in view of a chart and its associated list. */
        function toggleZoom(btn) {
            const overlay = document.getElementById('zoom-overlay');
            if (!overlay) return;
 
            if (overlay.style.display !== 'flex') {
                const pieRow = btn.closest('.pie-row');
                const clone = pieRow.cloneNode(true);
                const closeBtn = clone.querySelector('.zoom-btn');
                closeBtn.textContent = '✖';
                closeBtn.onclick = () => toggleZoom(closeBtn);
 
                overlay.innerHTML = '';
                overlay.appendChild(clone);
                overlay.style.display = 'flex';
 
                const originalCanvas = pieRow.querySelector('canvas');
                const clonedCanvas = clone.querySelector('canvas');
                const originalChart = Chart.getChart(originalCanvas);
                
                if (originalChart) {
                    // Re-create the chart in the cloned canvas
                    const newChart = new Chart(clonedCanvas.getContext('2d'), originalChart.config);
                    newChart.options.plugins.legend.position = 'bottom';
                    newChart.options.plugins.legend.align = 'center';
                    newChart.options.plugins.legend.onClick = null;
                    newChart.update();
                }
            } else {
                overlay.style.display = 'none';
                overlay.innerHTML = '';
            }
        }
 
        /* Filters a list based on user input and highlights matching text. */
        function filterList(input) {
            const filter = input.value.toLowerCase();
            const listBox = input.closest('.list-box');
            const items = listBox.querySelectorAll('ul li');
            const clearBtn = input.nextElementSibling;
 
            items.forEach(item => {
                const text = item.textContent || item.innerText;
                item.innerHTML = text; // Reset innerHTML before highlighting
                if (filter && text.toLowerCase().includes(filter)) {
                    const regex = new RegExp(`(${filter})`, 'i');
                    item.innerHTML = text.replace(regex, '<mark>$1</mark>');
                    item.style.display = '';
                } else {
                    item.style.display = filter ? 'none' : '';
                }
            });
        }
 
        /* Clears the search input field and resets the list view. */
        function clearSearch(btn) {
            const input = btn.previousElementSibling;
            input.value = '';
            btn.style.display = 'none';
            filterList(input);
        }
 
        function logAction(action, taskText, row = null) {
            const logConfig = {
                'Added':         { icon: '🟢', flash: 'flash-green' },
                'Deleted':       { icon: '🔴', flash: 'flash-red' },
                'Task changed':  { icon: '🟣', flash: 'flash-green' },
                'Marked as done':{ icon: '🟡', flash: 'flash-yellow' },
                'Unchecked':     { icon: '🔵', flash: 'flash-gray' }
            };
 
            const config = logConfig[action] || { icon: '', flash: '' };
            
            const historyList = document.getElementById('historyList');
            const newEntry = document.createElement('li');
            const timestamp = new Date().toLocaleString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                second: '2-digit'
            });
            
            newEntry.innerHTML =
                `${config.icon} ${action} "${taskText}" — <span style="color:#888; font-size:12px;">(${timestamp})</span>`;
            
            historyList.prepend(newEntry);
            flashBoth(newEntry, row, config.flash, 1000);
        }
 
        // ========== 3. TASK LIST FUNCTIONS =========== //
        /* Adds a new task to the task list table from the input field. */
        function addTask() {
            const input = document.getElementById('newTaskInput');
            const taskText = input.value.trim();
            if (taskText === '') {
                alert('Please enter a task before clicking "Add".');
                return;
            }
 
            const taskList = document.getElementById('taskList');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="checkbox"></td>
                <td><span class="task-text" contenteditable="false" data-original-text="${taskText}">${taskText}</span></td>
                <td><button class="delete-btn">✖</button></td>
            `;
            taskList.appendChild(newRow);
 
            attachCheckboxListener(newRow.querySelector('input[type="checkbox"]'));
 
            logAction('Added', taskText, newRow);
 
            input.value = '';
            document.querySelector('.clear-btn-task').style.display = 'none';
        }
 
        /* Clears the text from the 'Enter new task' input field and hides the clear button. */
        function clearTaskInput() {
            const input = document.getElementById('newTaskInput');
            input.value = '';
            input.focus();
            document.querySelector('.clear-btn-task').style.display = 'none';
        }
 
        /* Manages task editing with a dynamic message. */
        function saveTaskEdit(element) {
            const taskRow = element.closest('tr');
 
            if (taskRow.classList.contains('done')) {
                alert("Action cannot be made. The task is already marked as done.");
                return;
            }
 
            const existingMessageRow = document.querySelector('.edit-message-row');
            if (existingMessageRow) existingMessageRow.remove();
 
            const messageRow = document.createElement('tr');
            messageRow.className = 'edit-message-row';
            messageRow.innerHTML = `
                <td colspan="3" class="edit-message">
                    EDITING: Press <strong>enter</strong> to save changes, or click <strong>anywhere</strong> else to cancel.
                </td>
            `;
            taskRow.after(messageRow);
 
            const handleKeydown = (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    const newText = element.textContent.trim();
                    const originalText = element.dataset.originalText;
 
                    if (newText === '') {
                        alert("Task cannot be empty. Reverting to original text.");
                        element.textContent = originalText;
                    } else if (newText !== originalText) {
                        logAction('Task changed', `${originalText}" to "${newText}`, taskRow);
                        element.dataset.originalText = newText;
                    }
 
                    cleanup();
                }
            };
 
            const handleBlur = () => {
                const newText = element.textContent.trim();
                const originalText = element.dataset.originalText;
 
                if (newText !== originalText) {
                    // Revert changes silently on cancel
                    element.textContent = originalText;
                }
                cleanup();
            };
 
            function cleanup() {
                messageRow.remove();
                element.contentEditable = false;
                element.removeEventListener('keydown', handleKeydown);
                element.removeEventListener('blur', handleBlur);
            }
 
            element.contentEditable = true;
            element.focus();
            element.addEventListener('keydown', handleKeydown);
            element.addEventListener('blur', handleBlur);
        }
 
        /* Attaches a change event listener to a task checkbox to toggle the 'done' class. */
        function attachCheckboxListener(checkbox) {
            checkbox.addEventListener('change', function() {
                const row = this.closest('tr');
                const taskText = row.children[1].textContent;
                if (this.checked) {
                    row.classList.add('done');
                    logAction('Marked as done', taskText, row);
                } else {
                    row.classList.remove('done');
                    logAction('Unchecked', taskText, row);
                }
            });
        }
 
        /* Deletes a task row from the list after confirmation. */
        function deleteTask(event) {
            event.preventDefault();
            const row = event.target.closest('tr');
            if (!row) return;
 
            const taskText = row.children[1].textContent;
            if (confirmAction(`Are you sure you want to delete "${taskText}"?`)) {
                logAction('Deleted', taskText, row);
                setTimeout(() => row.remove(), 1000);
            }
        }
 
        /* Adds a new entry to the change history list. */
        function addHistoryEntry(message, flashClass = '') {
            const historyList = document.getElementById('historyList');
            const newEntry = document.createElement('li');
            const timestamp = new Date().toLocaleString();
 
            newEntry.innerHTML =
                `${message} — <span style="color:#888; font-size:12px;">(${timestamp})</span>`;
 
            historyList.prepend(newEntry);
 
            if (flashClass) {
                newEntry.classList.add(flashClass);
                setTimeout(() => newEntry.classList.remove(flashClass), FLASH_DURATION);
            }
        }
 
        // ==== 4. INITIALIZATION & EVENT LISTENERS ==== //
        document.addEventListener('DOMContentLoaded', () => {
            // Apply a dark scrollbar style to list boxes if they are scrollable
            document.querySelectorAll('.list-box').forEach(box => {
                if (box.scrollHeight > box.clientHeight) {
                    box.classList.add('scroll-dark');
                }
            });
            
            // Data for the pie charts
            const chartData = [
                ['sgcDeployed', ['Deployed','Not Deployed'], [900,100]],
                ['sgcStatus', ['Online','Offline'], [850,50]],
                ['defenderInstalled', ['Active','Inactive'], [920,80]],
                ['defenderStatus', ['Updated','Outdated'], [900,20]]
            ];
            
            // Create all pie charts on page load
            chartData.forEach(args => makeThemedPie(...args));
            
            // Event listener for adding tasks with the Enter key
            document.getElementById('newTaskInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addTask();
                }
            });
            
            // Event delegation for editing tasks
            document.getElementById('taskList').addEventListener('click', function(event) {
            const target = event.target;
            
            // Add this new check for the delete button
            if (target.classList.contains('delete-btn')) {
                deleteTask(event);
                return;
            }
 
            if (target.classList.contains('task-text')) {
                const taskRow = target.closest('tr');
                if (taskRow && taskRow.classList.contains('done')) {
                    alert("Action cannot be made. The task is already marked as done.");
                    return;
                }
                target.focus();
                saveTaskEdit(target);
            }
        });
            
            // Global listener to show/hide the 'clear search' button
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('list-search')) {
                    const clearBtn = e.target.nextElementSibling;
                    clearBtn.style.display = e.target.value.trim() ? 'inline-block' : 'none';
                } else if (e.target.id === 'newTaskInput') {
                    const inputContainer = e.target.closest('.addTask-form');
                    const clearBtn = inputContainer.querySelector('.clear-btn-task');
                    clearBtn.style.display = e.target.value.trim() ? 'inline-block' : 'none';
                }
            });
 
            // Global listener to close the zoom overlay with the Escape key
            document.addEventListener('keydown', e => {
                if (e.key === "Escape") {
                    document.getElementById('zoom-overlay').style.display = 'none';
                }
            });
        });
    </script>
</body>